"use strict";(self.webpackChunkdatakit_docs=self.webpackChunkdatakit_docs||[]).push([[282],{6861:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>d});var n=a(4848),i=a(8453);const s={},l="Creating DataViews",r={id:"creating-dataviews",title:"Creating DataViews",description:"To create a DataView you need to call any of the named constructors available:",source:"@site/docs/10-creating-dataviews.md",sourceDirName:".",slug:"/creating-dataviews",permalink:"/creating-dataviews",draft:!1,unlisted:!1,editUrl:"https://github.com/UseDataKit/SDK/edit/main/docs/10-creating-dataviews.md",tags:[],version:"current",sidebarPosition:10,frontMatter:{},sidebar:"docs",previous:{title:"DataKit Intro",permalink:"/"},next:{title:"Filters",permalink:"/filters"}},o={},d=[{value:"Apply settings",id:"apply-settings",level:2},{value:"Searching",id:"searching",level:3},{value:"Pagination &amp; Sorting",id:"pagination--sorting",level:3},{value:"Sorting by field",id:"sorting-by-field",level:4},{value:"Set pagination defaults",id:"set-pagination-defaults",level:4},{value:"View single results",id:"view-single-results",level:2},{value:"Delete a result",id:"delete-a-result",level:2}];function c(e){const t={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"creating-dataviews",children:"Creating DataViews"})}),"\n",(0,n.jsxs)(t.p,{children:["To create a ",(0,n.jsx)(t.code,{children:"DataView"})," you need to call any of the named constructors available:"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"DataView::table()"})," - Creates a DataView with a ",(0,n.jsx)(t.code,{children:"table"})," view type."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"DataView::list()"})," - (Not available yet) Creates a DataView with a ",(0,n.jsx)(t.code,{children:"list"})," view type."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"DataView::grid()"})," - (Not available yet) Creates a DataView with a ",(0,n.jsx)(t.code,{children:"grid"})," view type."]}),"\n"]}),"\n",(0,n.jsx)(t.admonition,{type:"note",children:(0,n.jsxs)(t.p,{children:["Since every view type has different required parameters, the ",(0,n.jsx)(t.code,{children:"new DataView()"})," creation is ",(0,n.jsx)(t.em,{children:"not"})," available. The\nnamed constructors will have all the required parameters, and make for a fluent and expressive API."]})}),"\n",(0,n.jsx)(t.h2,{id:"apply-settings",children:"Apply settings"}),"\n",(0,n.jsx)(t.p,{children:"A DataView has a public API for applying some default settings to the component."}),"\n",(0,n.jsx)(t.h3,{id:"searching",children:"Searching"}),"\n",(0,n.jsxs)(t.p,{children:["By default, search is enabled on the DataView component. To disable this, you can call the ",(0,n.jsx)(t.code,{children:"disable_search()"})," method on\nthe instance."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-php",children:"$dataview = DataView::table( ... )->disable_search();\n"})}),"\n",(0,n.jsxs)(t.p,{children:["It is also possible to (re-enable and) set the initial search value on the instance by calling\nthe ",(0,n.jsx)(t.code,{children:"search( string $search)"})," method. You can use this for example to use a query-string parameter from the current url."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-php",children:"// A dataview that prefills the search value with the value from `?search=search+string`.\n$dataview = DataView::table( ... )->search( $_GET['search'] ?? '');\n"})}),"\n",(0,n.jsx)(t.h3,{id:"pagination--sorting",children:"Pagination & Sorting"}),"\n",(0,n.jsx)(t.p,{children:"As a DataView can paginate and sort by default, you can also provide an initial sorting and pagination."}),"\n",(0,n.jsx)(t.h4,{id:"sorting-by-field",children:"Sorting by field"}),"\n",(0,n.jsxs)(t.p,{children:["A DataView can be sorted by calling the ",(0,n.jsx)(t.code,{children:"sort( ?Sort $sort )"})," method. It requires a ",(0,n.jsx)(t.code,{children:"Sort"})," object to be passed,\nor ",(0,n.jsx)(t.code,{children:"null"})," to remove any prior set sorting. The ",(0,n.jsx)(t.code,{children:"Sort"})," object can be created with 2 named constructors:"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"Sort::asc( string $field )"})," Creates a ascending ",(0,n.jsx)(t.code,{children:"Sort"})," object on a single field."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"Sort::desc( string $field )"})," Creates a descending ",(0,n.jsx)(t.code,{children:"Sort"})," object on a single field."]}),"\n"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-php",children:"// Apply a default descending sort on `date_created`.\n$dataview = DataView::table( ... )->sort( Sort::desc( 'date_created' ) );\n"})}),"\n",(0,n.jsx)(t.h4,{id:"set-pagination-defaults",children:"Set pagination defaults"}),"\n",(0,n.jsx)(t.p,{children:"By default, a DataView is paginated with 25 results per page. You can overwrite this in two way:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["Using the WordPress filter-hook ",(0,n.jsx)(t.code,{children:"datakit/dataview/pagination/per-page-default"})," to set a value for all DataViews."]}),"\n",(0,n.jsxs)(t.li,{children:["By using the ",(0,n.jsx)(t.code,{children:"paginate( int $per_page, int $page = 1)"})," method on the DataView."]}),"\n"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-php",children:"// Update the default per page amount to 50 results.\nadd_filter( 'datakit/dataview/pagination/per-page-default', fn( int $per_page ):int => 50 );\n\n// Or set the pagination on the DataView.\n$dataview = DataView::table( ... )->paginate( 50, $_GET['page'] ?? 1 );\n"})}),"\n",(0,n.jsx)(t.p,{children:"As you can see, you can also optionally provide the current page. This is useful if you want to use a query parameter on\nthe URL to provide the page number to load."}),"\n",(0,n.jsx)(t.h2,{id:"view-single-results",children:"View single results"}),"\n",(0,n.jsxs)(t.p,{children:["We understand that sometimes you want to show more information for a single result than in possible on a list view. You\nwant to make your results viewable. This is why we introduced the ",(0,n.jsx)(t.code,{children:"->viewable( array $fields, string $label = 'View')"}),"\nmethod on the DataView. Calling this method will add a primary view action on the list item."]}),"\n",(0,n.jsx)(t.p,{children:"As you might have noticed you need to provide an array of fields (the same way as you would on the DataView object), and\nan (optional) label. This label is applied on the action button in the UI."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-php",children:"$dataview = DataView::table( ... )\n    ->viewable( [\n        TextField::create( ... ),\n        // Other fields...\n    ] );\n"})}),"\n",(0,n.jsxs)(t.p,{children:["Clicking the ",(0,n.jsx)(t.code,{children:"View"})," action on the UI will open a Modal with all the fields and data for that single item."]}),"\n",(0,n.jsxs)(t.p,{children:["By default we use a ",(0,n.jsx)(t.code,{children:"<table>"})," template with the same styles as a DataView applied. But you can replace this template\ncompletely by using the",(0,n.jsx)(t.code,{children:"datakit/dataview/view/template"})," WordPress filter-hook. This hook receives:"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"The current absolute path to the template"}),"\n",(0,n.jsx)(t.li,{children:"The current DataView object"}),"\n",(0,n.jsxs)(t.li,{children:["A ",(0,n.jsx)(t.code,{children:"DataView"})," item that contains the fields and data for the single result"]}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["The hook should return an absolute path to a template file. You can inspect\nthe ",(0,n.jsx)(t.a,{href:"https://github.com/GravityKit/DataKit/blob/main/templates/view/table.php",children:"original template"})," to get some\ninspiration."]}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.em,{children:"Tip"}),": To close the modal using a link or button in your template, you can mark that element with a ",(0,n.jsx)(t.code,{children:"data-close-modal"}),"\nattribute."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-html",children:'<button data-close-modal type="button">Close modal</button>\n'})}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"delete-a-result",children:"Delete a result"}),"\n",(0,n.jsxs)(t.p,{children:["In some situations, you might want to be able to delete a result from the list. For this we introduced\nthe ",(0,n.jsx)(t.code,{children:"->deletable( string $label, ?callable $callback = null)"})," method on the DataView."]}),"\n",(0,n.jsx)(t.admonition,{type:"note",children:(0,n.jsxs)(t.p,{children:["This functionality requires the DataView to have a ",(0,n.jsx)(t.code,{children:"MutableDataSource"})," which ",(0,n.jsx)(t.code,{children:"can_delete()"}),". This data source is\nresponsible for deleting the results. If the data source can not delete results, calling the ",(0,n.jsx)(t.code,{children:"deleteable()"})," method will\nnot do anything."]})}),"\n",(0,n.jsx)(t.p,{children:'Once the method is called, it will add a primary, destructive "Delete" bulk-action on the results. Clicking this will\nperform an AJAX call to the REST API, which in turn will instruct the data source to delete the results by their IDs.\nAfter this action, the current result set on the DataView is refreshed.'}),"\n",(0,n.jsxs)(t.p,{children:["You can provide a different ",(0,n.jsx)(t.code,{children:"$label"})," on the method which is used as a label on the action button."]}),"\n",(0,n.jsxs)(t.p,{children:["Because this is a destructive action we've added a default confirmation message on the action. To change this message,\nor any other option on the action you can use the ",(0,n.jsx)(t.code,{children:"$callback"})," parameter. The callable provided to this parameter will\nreceive the created ",(0,n.jsx)(t.code,{children:"Action"})," object, and should return an action as well."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-php",children:"use DataKit\\DataViews\\DataView\\Action;\n\n$dataview = DataView::table( ... )\n    ->deletable( 'Delete', function ( Action $action ): Action {\n        return $action\n            ->single() // Make it a single result action, instead of bulk.\n            ->confirm( 'Are you sure you want to delete this item?' ); // Set a singular item message.\n    });\n"})}),"\n",(0,n.jsx)(t.admonition,{type:"note",children:(0,n.jsxs)(t.p,{children:["An ",(0,n.jsx)(t.code,{children:"Action"})," object is immutable. Any method call will return a new instance with the changes applied. This is\nwhy we return the result of the ",(0,n.jsx)(t.code,{children:"confirm()"})," method, instead of calling the methods and then return the ",(0,n.jsx)(t.code,{children:"$action"}),"\nvariable. That would return the exact instance that was provided, causing no changes to be applied."]})})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},8453:(e,t,a)=>{a.d(t,{R:()=>l,x:()=>r});var n=a(6540);const i={},s=n.createContext(i);function l(e){const t=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),n.createElement(s.Provider,{value:t},e.children)}}}]);